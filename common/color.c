#include "spectrum.h"

double3 spectrum_to_xyz(int lambda)
{
    const double3 sample_to_xyz[] = {
		DOUBLE3(0.000000, 0.000015, 0.000104),
		DOUBLE3(0.000000, 0.000017, 0.000122),
		DOUBLE3(0.000000, 0.000019, 0.000143),
		DOUBLE3(0.000000, 0.000021, 0.000167),
		DOUBLE3(0.000000, 0.000023, 0.000196),
		DOUBLE3(0.000000, 0.000025, 0.000228),
		DOUBLE3(0.000000, 0.000028, 0.000266),
		DOUBLE3(0.000000, 0.000031, 0.000310),
		DOUBLE3(0.000000, 0.000034, 0.000360),
		DOUBLE3(0.000001, 0.000037, 0.000418),
		DOUBLE3(0.000001, 0.000041, 0.000484),
		DOUBLE3(0.000001, 0.000045, 0.000560),
		DOUBLE3(0.000001, 0.000049, 0.000647),
		DOUBLE3(0.000002, 0.000054, 0.000746),
		DOUBLE3(0.000003, 0.000059, 0.000859),
		DOUBLE3(0.000003, 0.000065, 0.000988),
		DOUBLE3(0.000005, 0.000071, 0.001135),
		DOUBLE3(0.000006, 0.000078, 0.001301),
		DOUBLE3(0.000008, 0.000086, 0.001490),
		DOUBLE3(0.000011, 0.000094, 0.001703),
		DOUBLE3(0.000015, 0.000103, 0.001944),
		DOUBLE3(0.000019, 0.000113, 0.002216),
		DOUBLE3(0.000025, 0.000123, 0.002523),
		DOUBLE3(0.000033, 0.000135, 0.002867),
		DOUBLE3(0.000043, 0.000147, 0.003254),
		DOUBLE3(0.000056, 0.000161, 0.003688),
		DOUBLE3(0.000073, 0.000176, 0.004173),
		DOUBLE3(0.000094, 0.000192, 0.004715),
		DOUBLE3(0.000121, 0.000209, 0.005321),
		DOUBLE3(0.000156, 0.000228, 0.005995),
		DOUBLE3(0.000199, 0.000249, 0.006746),
		DOUBLE3(0.000253, 0.000271, 0.007581),
		DOUBLE3(0.000320, 0.000295, 0.008508),
		DOUBLE3(0.000404, 0.000321, 0.009535),
		DOUBLE3(0.000507, 0.000349, 0.010674),
		DOUBLE3(0.000635, 0.000380, 0.011935),
		DOUBLE3(0.000792, 0.000413, 0.013330),
		DOUBLE3(0.000984, 0.000448, 0.014874),
		DOUBLE3(0.001217, 0.000487, 0.016582),
		DOUBLE3(0.001500, 0.000528, 0.018472),
		DOUBLE3(0.001841, 0.000573, 0.020565),
		DOUBLE3(0.002252, 0.000622, 0.022885),
		DOUBLE3(0.002743, 0.000674, 0.025459),
		DOUBLE3(0.003328, 0.000730, 0.028322),
		DOUBLE3(0.004022, 0.000791, 0.031512),
		DOUBLE3(0.004842, 0.000856, 0.035076),
		DOUBLE3(0.005806, 0.000926, 0.039067),
		DOUBLE3(0.006935, 0.001001, 0.043552),
		DOUBLE3(0.008252, 0.001082, 0.048606),
		DOUBLE3(0.009780, 0.001170, 0.054318),
		DOUBLE3(0.011547, 0.001263, 0.060795),
		DOUBLE3(0.013579, 0.001364, 0.068157),
		DOUBLE3(0.015906, 0.001471, 0.076546),
		DOUBLE3(0.018560, 0.001587, 0.086120),
		DOUBLE3(0.021572, 0.001711, 0.097062),
		DOUBLE3(0.024974, 0.001843, 0.109573),
		DOUBLE3(0.028802, 0.001985, 0.123877),
		DOUBLE3(0.033086, 0.002138, 0.140217),
		DOUBLE3(0.037859, 0.002300, 0.158852),
		DOUBLE3(0.043151, 0.002474, 0.180057),
		DOUBLE3(0.048992, 0.002660, 0.204114),
		DOUBLE3(0.055407, 0.002858, 0.231306),
		DOUBLE3(0.062417, 0.003070, 0.261913),
		DOUBLE3(0.070040, 0.003296, 0.296195),
		DOUBLE3(0.078287, 0.003537, 0.334387),
		DOUBLE3(0.087165, 0.003795, 0.376686),
		DOUBLE3(0.096670, 0.004068, 0.423234),
		DOUBLE3(0.106794, 0.004360, 0.474108),
		DOUBLE3(0.117519, 0.004671, 0.529306),
		DOUBLE3(0.128816, 0.005001, 0.588735),
		DOUBLE3(0.140648, 0.005352, 0.652200),
		DOUBLE3(0.152968, 0.005725, 0.719394),
		DOUBLE3(0.165718, 0.006122, 0.789895),
		DOUBLE3(0.178831, 0.006543, 0.863160),
		DOUBLE3(0.192228, 0.006990, 0.938534),
		DOUBLE3(0.205822, 0.007464, 1.015247),
		DOUBLE3(0.219519, 0.007966, 1.092437),
		DOUBLE3(0.233212, 0.008498, 1.169154),
		DOUBLE3(0.246793, 0.009062, 1.244392),
		DOUBLE3(0.260145, 0.009659, 1.317104),
		DOUBLE3(0.273148, 0.010291, 1.386237),
		DOUBLE3(0.285681, 0.010958, 1.450755),
		DOUBLE3(0.297622, 0.011664, 1.509675),
		DOUBLE3(0.308849, 0.012410, 1.562096),
		DOUBLE3(0.319247, 0.013197, 1.607223),
		DOUBLE3(0.328703, 0.014028, 1.644401),
		DOUBLE3(0.337114, 0.014905, 1.673127),
		DOUBLE3(0.344386, 0.015829, 1.693074),
		DOUBLE3(0.350435, 0.016802, 1.707990),
		DOUBLE3(0.355191, 0.017828, 1.721715),
		DOUBLE3(0.358596, 0.018907, 1.734199),
		DOUBLE3(0.360609, 0.020043, 1.745395),
		DOUBLE3(0.361204, 0.021237, 1.755256),
		DOUBLE3(0.360823, 0.022492, 1.763740),
		DOUBLE3(0.359919, 0.023810, 1.770806),
		DOUBLE3(0.358492, 0.025195, 1.776416),
		DOUBLE3(0.356547, 0.026647, 1.780537),
		DOUBLE3(0.354089, 0.028171, 1.783139),
		DOUBLE3(0.351125, 0.029768, 1.784194),
		DOUBLE3(0.347664, 0.031442, 1.783681),
		DOUBLE3(0.343717, 0.033195, 1.781581),
		DOUBLE3(0.339297, 0.035029, 1.777881),
		DOUBLE3(0.334418, 0.036949, 1.772574),
		DOUBLE3(0.329096, 0.038955, 1.765654),
		DOUBLE3(0.323348, 0.041053, 1.757123),
		DOUBLE3(0.317193, 0.043244, 1.746987),
		DOUBLE3(0.310651, 0.045531, 1.735258),
		DOUBLE3(0.303743, 0.047918, 1.721953),
		DOUBLE3(0.296491, 0.050408, 1.707094),
		DOUBLE3(0.288918, 0.053003, 1.690707),
		DOUBLE3(0.281047, 0.055708, 1.671543),
		DOUBLE3(0.272902, 0.058525, 1.648383),
		DOUBLE3(0.264510, 0.061458, 1.621345),
		DOUBLE3(0.255895, 0.064510, 1.590602),
		DOUBLE3(0.247083, 0.067685, 1.556376),
		DOUBLE3(0.238100, 0.070987, 1.518934),
		DOUBLE3(0.228973, 0.074418, 1.478582),
		DOUBLE3(0.219727, 0.077985, 1.435659),
		DOUBLE3(0.210390, 0.081689, 1.390527),
		DOUBLE3(0.200987, 0.085537, 1.343567),
		DOUBLE3(0.191544, 0.089532, 1.295168),
		DOUBLE3(0.182089, 0.093680, 1.245722),
		DOUBLE3(0.172647, 0.097985, 1.195612),
		DOUBLE3(0.163243, 0.102455, 1.145209),
		DOUBLE3(0.153902, 0.107094, 1.094868),
		DOUBLE3(0.144650, 0.111909, 1.044914),
		DOUBLE3(0.135511, 0.116909, 0.995648),
		DOUBLE3(0.126508, 0.122100, 0.947336),
		DOUBLE3(0.117666, 0.127493, 0.900211),
		DOUBLE3(0.109007, 0.133095, 0.854471),
		DOUBLE3(0.100554, 0.138919, 0.810275),
		DOUBLE3(0.092329, 0.144976, 0.767752),
		DOUBLE3(0.084352, 0.151278, 0.726992),
		DOUBLE3(0.076644, 0.157839, 0.688057),
		DOUBLE3(0.069224, 0.164674, 0.650978),
		DOUBLE3(0.062112, 0.171799, 0.615761),
		DOUBLE3(0.055325, 0.179231, 0.582387),
		DOUBLE3(0.048881, 0.186990, 0.550821),
		DOUBLE3(0.042796, 0.195094, 0.521010),
		DOUBLE3(0.037085, 0.203565, 0.492887),
		DOUBLE3(0.031763, 0.212424, 0.466377),
		DOUBLE3(0.026842, 0.221693, 0.441398),
		DOUBLE3(0.022335, 0.231396, 0.417864),
		DOUBLE3(0.018253, 0.241557, 0.395687),
		DOUBLE3(0.014606, 0.252198, 0.374780),
		DOUBLE3(0.011402, 0.263344, 0.355056),
		DOUBLE3(0.008649, 0.275015, 0.336432),
		DOUBLE3(0.006353, 0.287234, 0.318830),
		DOUBLE3(0.004520, 0.300020, 0.302177),
		DOUBLE3(0.003152, 0.313389, 0.286402),
		DOUBLE3(0.002253, 0.327358, 0.271444),
		DOUBLE3(0.001824, 0.341935, 0.257244),
		DOUBLE3(0.001841, 0.357129, 0.243750),
		DOUBLE3(0.002265, 0.372940, 0.230914),
		DOUBLE3(0.003097, 0.389366, 0.218696),
		DOUBLE3(0.004335, 0.406398, 0.207056),
		DOUBLE3(0.005977, 0.424019, 0.195962),
		DOUBLE3(0.008021, 0.442207, 0.185382),
		DOUBLE3(0.010465, 0.460933, 0.175291),
		DOUBLE3(0.013307, 0.480158, 0.165664),
		DOUBLE3(0.016544, 0.499838, 0.156479),
		DOUBLE3(0.020174, 0.519919, 0.147718),
		DOUBLE3(0.024193, 0.540340, 0.139362),
		DOUBLE3(0.028600, 0.561034, 0.131395),
		DOUBLE3(0.033391, 0.581925, 0.123801),
		DOUBLE3(0.038564, 0.602932, 0.116568),
		DOUBLE3(0.044115, 0.623967, 0.109681),
		DOUBLE3(0.050041, 0.644938, 0.103128),
		DOUBLE3(0.056340, 0.665750, 0.096897),
		DOUBLE3(0.063008, 0.686303, 0.090976),
		DOUBLE3(0.070043, 0.706498, 0.085354),
		DOUBLE3(0.077442, 0.726235, 0.080020),
		DOUBLE3(0.085201, 0.745416, 0.074963),
		DOUBLE3(0.093319, 0.763946, 0.070172),
		DOUBLE3(0.101791, 0.781733, 0.065639),
		DOUBLE3(0.110616, 0.798692, 0.061351),
		DOUBLE3(0.119789, 0.814745, 0.057300),
		DOUBLE3(0.129309, 0.829822, 0.053475),
		DOUBLE3(0.139172, 0.843862, 0.049867),
		DOUBLE3(0.149374, 0.856814, 0.046467),
		DOUBLE3(0.159914, 0.868640, 0.043266),
		DOUBLE3(0.170786, 0.879316, 0.040254),
		DOUBLE3(0.181988, 0.889285, 0.037423),
		DOUBLE3(0.193517, 0.898854, 0.034765),
		DOUBLE3(0.205367, 0.908014, 0.032270),
		DOUBLE3(0.217535, 0.916754, 0.029931),
		DOUBLE3(0.230017, 0.925068, 0.027741),
		DOUBLE3(0.242807, 0.932949, 0.025691),
		DOUBLE3(0.255900, 0.940391, 0.023774),
		DOUBLE3(0.269290, 0.947389, 0.021983),
		DOUBLE3(0.282972, 0.953939, 0.020311),
		DOUBLE3(0.296940, 0.960037, 0.018752),
		DOUBLE3(0.311185, 0.965681, 0.017299),
		DOUBLE3(0.325700, 0.970870, 0.015947),
		DOUBLE3(0.340478, 0.975602, 0.014689),
		DOUBLE3(0.355509, 0.979878, 0.013520),
		DOUBLE3(0.370783, 0.983698, 0.012434),
		DOUBLE3(0.386292, 0.987064, 0.011426),
		DOUBLE3(0.402024, 0.989979, 0.010493),
		DOUBLE3(0.417967, 0.992444, 0.009628),
		DOUBLE3(0.434110, 0.994464, 0.008827),
		DOUBLE3(0.450438, 0.996042, 0.008087),
		DOUBLE3(0.466939, 0.997183, 0.007403),
		DOUBLE3(0.483598, 0.997893, 0.006772),
		DOUBLE3(0.500399, 0.998176, 0.006190),
		DOUBLE3(0.517327, 0.998039, 0.005653),
		DOUBLE3(0.534364, 0.997487, 0.005159),
		DOUBLE3(0.551493, 0.996529, 0.004705),
		DOUBLE3(0.568695, 0.995170, 0.004287),
		DOUBLE3(0.585951, 0.993419, 0.003903),
		DOUBLE3(0.603241, 0.991282, 0.003551),
		DOUBLE3(0.620544, 0.988768, 0.003229),
		DOUBLE3(0.637839, 0.985883, 0.002933),
		DOUBLE3(0.655105, 0.982638, 0.002662),
		DOUBLE3(0.672317, 0.979039, 0.002415),
		DOUBLE3(0.689454, 0.975095, 0.002188),
		DOUBLE3(0.706492, 0.970814, 0.001982),
		DOUBLE3(0.723406, 0.966204, 0.001793),
		DOUBLE3(0.740172, 0.961275, 0.001622),
		DOUBLE3(0.756765, 0.956031, 0.001465),
		DOUBLE3(0.773160, 0.950398, 0.001323),
		DOUBLE3(0.789331, 0.944342, 0.001193),
		DOUBLE3(0.805253, 0.937874, 0.001076),
		DOUBLE3(0.820901, 0.931002, 0.000969),
		DOUBLE3(0.836247, 0.923736, 0.000872),
		DOUBLE3(0.851268, 0.916086, 0.000784),
		DOUBLE3(0.865937, 0.908062, 0.000705),
		DOUBLE3(0.880229, 0.899675, 0.000633),
		DOUBLE3(0.894120, 0.890936, 0.000568),
		DOUBLE3(0.907583, 0.881856, 0.000509),
		DOUBLE3(0.920596, 0.872446, 0.000456),
		DOUBLE3(0.933134, 0.862718, 0.000408),
		DOUBLE3(0.945175, 0.852684, 0.000365),
		DOUBLE3(0.956696, 0.842356, 0.000326),
		DOUBLE3(0.967675, 0.831747, 0.000292),
		DOUBLE3(0.978092, 0.820868, 0.000260),
		DOUBLE3(0.987926, 0.809734, 0.000232),
		DOUBLE3(0.997159, 0.798356, 0.000207),
		DOUBLE3(1.005773, 0.786749, 0.000184),
		DOUBLE3(1.013750, 0.774924, 0.000164),
		DOUBLE3(1.021075, 0.762896, 0.000146),
		DOUBLE3(1.027734, 0.750678, 0.000129),
		DOUBLE3(1.033713, 0.738284, 0.000115),
		DOUBLE3(1.039001, 0.725727, 0.000102),
		DOUBLE3(1.043586, 0.713021, 0.000090),
		DOUBLE3(1.047459, 0.700180, 0.000080),
		DOUBLE3(1.050613, 0.687218, 0.000071),
		DOUBLE3(1.053042, 0.674148, 0.000063),
		DOUBLE3(1.054740, 0.660985, 0.000055),
		DOUBLE3(1.055704, 0.647742, 0.000049),
		DOUBLE3(1.055926, 0.634432, 0.000043),
		DOUBLE3(1.055164, 0.621070, 0.000038),
		DOUBLE3(1.053305, 0.607669, 0.000033),
		DOUBLE3(1.050355, 0.594242, 0.000029),
		DOUBLE3(1.046323, 0.580802, 0.000026),
		DOUBLE3(1.041222, 0.567363, 0.000023),
		DOUBLE3(1.035068, 0.553938, 0.000020),
		DOUBLE3(1.027880, 0.540538, 0.000018),
		DOUBLE3(1.019679, 0.527177, 0.000015),
		DOUBLE3(1.010492, 0.513867, 0.000013),
		DOUBLE3(1.000346, 0.500619, 0.000012),
		DOUBLE3(0.989271, 0.487445, 0.000010),
		DOUBLE3(0.977301, 0.474356, 0.000009),
		DOUBLE3(0.964472, 0.461364, 0.000008),
		DOUBLE3(0.950821, 0.448479, 0.000007),
		DOUBLE3(0.936388, 0.435710, 0.000006),
		DOUBLE3(0.921215, 0.423069, 0.000005),
		DOUBLE3(0.905345, 0.410563, 0.000005),
		DOUBLE3(0.888823, 0.398203, 0.000004),
		DOUBLE3(0.871696, 0.385997, 0.000003),
		DOUBLE3(0.854009, 0.373953, 0.000003),
		DOUBLE3(0.835810, 0.362079, 0.000003),
		DOUBLE3(0.817149, 0.350382, 0.000002),
		DOUBLE3(0.798073, 0.338868, 0.000002),
		DOUBLE3(0.778632, 0.327546, 0.000002),
		DOUBLE3(0.758875, 0.316419, 0.000001),
		DOUBLE3(0.738849, 0.305494, 0.000001),
		DOUBLE3(0.718604, 0.294775, 0.000001),
		DOUBLE3(0.698186, 0.284268, 0.000001),
		DOUBLE3(0.677644, 0.273976, 0.000001),
		DOUBLE3(0.657021, 0.263902, 0.000001),
		DOUBLE3(0.636364, 0.254051, 0.000001),
		DOUBLE3(0.615715, 0.244424, 0.000001),
		DOUBLE3(0.595116, 0.235025, 0.000000),
		DOUBLE3(0.574609, 0.225854, 0.000000),
		DOUBLE3(0.554231, 0.216913, 0.000000),
		DOUBLE3(0.534020, 0.208203, 0.000000),
		DOUBLE3(0.514010, 0.199725, 0.000000),
		DOUBLE3(0.494236, 0.191478, 0.000000),
		DOUBLE3(0.474728, 0.183464, 0.000000),
		DOUBLE3(0.455516, 0.175680, 0.000000),
		DOUBLE3(0.436627, 0.168127, 0.000000),
		DOUBLE3(0.418086, 0.160803, 0.000000),
		DOUBLE3(0.399916, 0.153706, 0.000000),
		DOUBLE3(0.382138, 0.146835, 0.000000),
		DOUBLE3(0.364770, 0.140187, 0.000000),
		DOUBLE3(0.347830, 0.133760, 0.000000),
		DOUBLE3(0.331331, 0.127551, 0.000000),
		DOUBLE3(0.315286, 0.121558, 0.000000),
		DOUBLE3(0.299707, 0.115776, 0.000000),
		DOUBLE3(0.284601, 0.110204, 0.000000),
		DOUBLE3(0.269975, 0.104837, 0.000000),
		DOUBLE3(0.255835, 0.099671, 0.000000),
		DOUBLE3(0.242183, 0.094702, 0.000000),
		DOUBLE3(0.229021, 0.089927, 0.000000),
		DOUBLE3(0.216349, 0.085341, 0.000000),
		DOUBLE3(0.204166, 0.080941, 0.000000),
		DOUBLE3(0.192469, 0.076721, 0.000000),
		DOUBLE3(0.181253, 0.072676, 0.000000),
		DOUBLE3(0.170513, 0.068804, 0.000000),
		DOUBLE3(0.160242, 0.065098, 0.000000),
		DOUBLE3(0.150434, 0.061555, 0.000000),
		DOUBLE3(0.141079, 0.058170, 0.000000),
		DOUBLE3(0.132168, 0.054937, 0.000000),
		DOUBLE3(0.123691, 0.051853, 0.000000),
		DOUBLE3(0.115638, 0.048912, 0.000000),
		DOUBLE3(0.107996, 0.046109, 0.000000),
		DOUBLE3(0.100755, 0.043442, 0.000000),
		DOUBLE3(0.093901, 0.040903, 0.000000),
		DOUBLE3(0.087423, 0.038490, 0.000000),
		DOUBLE3(0.081307, 0.036197, 0.000000),
		DOUBLE3(0.075540, 0.034020, 0.000000),
		DOUBLE3(0.070109, 0.031954, 0.000000),
		DOUBLE3(0.065001, 0.029996, 0.000000),
		DOUBLE3(0.060202, 0.028140, 0.000000),
		DOUBLE3(0.055700, 0.026383, 0.000000),
		DOUBLE3(0.051480, 0.024721, 0.000000),
		DOUBLE3(0.047531, 0.023150, 0.000000),
		DOUBLE3(0.043840, 0.021665, 0.000000),
		DOUBLE3(0.040392, 0.020263, 0.000000),
		DOUBLE3(0.037178, 0.018940, 0.000000),
		DOUBLE3(0.034183, 0.017693, 0.000000),
		DOUBLE3(0.031397, 0.016518, 0.000000),
		DOUBLE3(0.028808, 0.015412, 0.000000),
		DOUBLE3(0.026405, 0.014371, 0.000000),
		DOUBLE3(0.024178, 0.013392, 0.000000),
		DOUBLE3(0.022115, 0.012472, 0.000000),
		DOUBLE3(0.020207, 0.011608, 0.000000),
		DOUBLE3(0.018445, 0.010798, 0.000000),
		DOUBLE3(0.016818, 0.010038, 0.000000),
		DOUBLE3(0.015320, 0.009326, 0.000000),
		DOUBLE3(0.013940, 0.008659, 0.000000),
		DOUBLE3(0.012671, 0.008035, 0.000000),
		DOUBLE3(0.011506, 0.007451, 0.000000),
		DOUBLE3(0.010437, 0.006906, 0.000000),
		DOUBLE3(0.009458, 0.006396, 0.000000),
		DOUBLE3(0.008561, 0.005921, 0.000000),
		DOUBLE3(0.007742, 0.005477, 0.000000),
		DOUBLE3(0.006993, 0.005064, 0.000000),
		DOUBLE3(0.006311, 0.004679, 0.000000),
		DOUBLE3(0.005689, 0.004320, 0.000000)
    };

    return sample_to_xyz[lambda - SPECTRUM_START];
}

double3 spectrum_to_rgb(int lambda)
{
    double3 xyz = spectrum_to_xyz(lambda);
    double3 output = VEC3(
         3.2404542*xyz.x - 1.5371385*xyz.y - 0.4985314*xyz.z,
        -0.9692660*xyz.x + 1.8760108*xyz.y + 0.0415560*xyz.z,
         0.0556434*xyz.x - 0.2040259*xyz.y + 1.0572252*xyz.z
    );

    return output;
}
